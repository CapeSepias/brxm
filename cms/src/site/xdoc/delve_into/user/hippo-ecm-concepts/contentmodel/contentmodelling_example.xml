<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE document PUBLIC
  "-//Apache Software Foundation//DTD XDOC 1.0//EN"
  "http://maven.apache.org/dtd/xdoc_1_0.dtd">
  <!--
      Copyright 2007 Hippo

      Licensed under the Apache License, Version 2.0 (the  "License");
      you may not use this file except in compliance with the License.
      You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

      Unless required by applicable law or agreed to in writing, software
      distributed under the License is distributed on an "AS IS"
      BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
      See the License for the specific language governing permissions and
      limitations under the License.
  -->
  <document>
      <properties>
          <title>Content Modelling Example</title>
      </properties>
      <body>
          <section name="Content Modelling Example">
              <p>
                  This example: modelling a frontend site having a preview/live and NL/EN part.
              </p>
              <subsection name="STEP 1">
                  <p>
                  entry point from the site in the repository would be:
                  </p>
                  <source>
site-myproject
|-- nl
|   |-- live      (node nl-live)
|   `-- preview   (node nl-preview)
`-- en
    |-- live      (node en-live)
    `-- preview   (node en-preview)
                  </source>
                  <p>
                      where site-myproject is directly under the root folder. This is the only physical structure under 'site-myproject'!

                      nl-live, nl-preview, en-live, etc are *facetselect* nodes! They are a facetselect (filtered mirror)
                      on the actual content (containing documents + navigation). For example the node nl-live is:
                  </p>
                  <source>
jcr:primaryType: hippo:facetselect
hippo:facets: {language,state}
hippo:values: {nl,published}
hippo:modes:  {select,prefer}
hippo:docbase: <code>UUID of {/content-myproject}</code>
                  </source>

              </subsection>
              <subsection name="STEP 2">
                  <p>
                      the actual repository site content:
                  </p>
                  <source>
content-myproject
|-- pages
|   |-- home (hippo:handle)
|   |   |-- home (nl,published)   --> link : /index.jsp  , label : HOME
|   |   |   `--paragraphs
|   |   |      |-- paragraph1
|   |   |      `-- paragraph2
|   |   |-- home (nl,unpublished) --> link : /index.jsp  , label : HOME
|   |   |   `--paragraphs
|   |   |      `-- etc...
|   |   |-- home (en,published)   --> link : /index.jsp  , label : HOME
|   |   |   `--paragraphs
|   |   |      `-- etc...
|   |   `-- home (en,unpublished) --> link : /index.jsp  , label : HOME
|   |       `--paragraphs
|   |          `-- etc...
|   |
|   |-- about
|   |   |-- about (nl,published)   --> link : /index.jsp  , label : Over MYPROJECT
|   |   |   `-- etc...
|   |   |-- about (nl,unpublished) --> link : /index.jsp  , label : Over MYPROJECT
|   |   |   `-- etc...
|   |   |-- about (en,published)   --> link : /index.jsp  , label : About MYPROJECT
|   |   |   `-- etc...
|   |   `-- about (en,unpublished) --> link : /index.jsp  , label : About MYPROJECT
|   |       `-- etc...
|   `-- etc....
`-- navigation
    |-- default (hippo:handle)
    |   `-- default (nt:unstructured)
    |       |-- home
    |       |-- about
    |       `-- etc ...
    `-- alternate (hippo:handle)
        `-- some alt navigation
                  </source>
                  <p>
                      Now, the node /content-myproject/navigation/default/default/home is a facetselect with properties:
                  </p>
                  <source>
hippo:facets: {}
hippo:values: {}
hippo:modes:  {}
hippo:docbase: UUID of {/content-myproject/pages/home}
                  </source>
                  <p>
                      Since facets are empty, this facet select works as an mirror
                      (the trick is that it is a child of the facetselect nl-live or en-preview, see later)

                      and the node /content-myproject/navigation/default/default/about is a facetselect with properties:
                  </p>
                  <source>
hippo:facets: {}
hippo:values: {}
hippo:modes:  {}
hippo:docbase: UUID of {/content-myproject/pages/about}
                  </source>
              </subsection>
              <subsection name="STEP 3">
                  <p>Virtual tree</p>
                  <p>
                      When browsing in the above repository to <code>/content-myproject/navigation/default/default/home</code> I have a virtual tree
                      below 'home' of the actual content below <code>/content-myproject/pages/home</code>:
                  </p>
                  <source>
content-myproject
`-- navigation
    `-- default
        `-- default
            `-- home
                |-- home (nl,published)   --> link : /index.jsp  , label : HOME
                |   `--paragraphs
                |      |-- paragraph1
                |      `-- paragraph2
                |-- home (nl,unpublished) --> link : /index.jsp  , label : HOME
                |   `--paragraphs
                |      `-- etc...
                |-- home (en,published)   --> link : /index.jsp  , label : HOME
                |   `--paragraphs
                |      `-- etc...
                `-- home (en,unpublished) --> link : /index.jsp  , label : HOME
                    `--paragraphs
                       `-- etc...
                  </source>
              </subsection>

              <subsection name="STEP 4">
                  <p>putting it all together we have the model to create the site:
                  </p>
                  <p>
                      In the frontend, I browse to the link <code>http://www.myproject.nl/nl/preview</code> which corresponds to <code>nl</code> and <code>preview</code> site.

                      This will be translated (frontend knowledge/defined) to <code>/site-myproject/nl/preview</code>. Since <code>preview</code> is a facetselect with
                  </p>
                  <source>
hippo:facets: {language,state}
hippo:values: {nl,unpublished}
hippo:docbase: UUID of {/content-myproject/pages/about}
                  </source>
                  <p>
                      the content (virtual tree) below <code>preview</code> looks like:
                  </p>
                  <source>
site-myproject
`-- nl
    `-- preview
        |-- pages
        |   |-- home (hippo:handle)
        |   |   `-- home (nl,unpublished)   --> link : /index.jsp  , label : HOME
        |   |      `--paragraphs
        |   |          |-- paragraph1
        |   |          `-- paragraph2
        |   `-- about
        |       `-- about (nl,unpublished)   --> link : /index.jsp  , label : Over MYPROJECT
        `-- navigation
            |-- default (hippo:handle)
            |   `-- default (nt:unstructured)
            |       |-- home
            |       |-- about
            |       `-- etc ...
            `-- alternate (hippo:handle)
                `-- some alt navigation
                  </source>

                  <p>
                      And we see, that with  <code>preivew/nl/navigation/default</code> we only have to iterate over the children to
                      have the multilingual multistate aware navigation (because <code>navigation/default/home/home</code> is again
                      a facetselect with empty facet values, but inherits from parent facet, so only displaying <code>nl</code> and <code>preview</code>)
                      home from <code>pages/home</code>, and thus you can display the <code>nl</code> caption or title. The content to show in the homepage,
                      is simply displaying all child nodes below <code>nl/preview/pages/home</code> <b>or</b> all child nodes below
                      <code>nl/preview/navigation/default/default/home</code>, resulting in the same nodes.
                  </p>
                  <p>
                      For <code>about</code> and other nodes this works exactly the same.

                  </p>

              </subsection>

          </section>

      </body>
  </document>
