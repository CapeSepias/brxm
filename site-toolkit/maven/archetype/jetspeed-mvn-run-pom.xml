<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">

  <modelVersion>4.0.0</modelVersion>

  <parent>
    <artifactId>maven</artifactId>
    <groupId>org.onehippo.ecm.hst</groupId>
    <version>2.02.05-SNAPSHOT</version>
    <relativePath>..</relativePath>
  </parent>

  <name>Hippo Site Toolkit Archetype</name>
  <description>Hippo Site Toolkit Archetype</description>
  <groupId>org.onehippo.ecm.hst</groupId>
  <artifactId>hst-archetype</artifactId>
  <packaging>pom</packaging>

  <build>
    <defaultGoal>process-resources</defaultGoal>
  </build>

  <profiles>
    <profile>
      <id>run-war</id>
      <build>
        <defaultGoal>process-resources</defaultGoal>
        <plugins>
          <plugin>
	    <groupId>org.apache.maven.plugins</groupId>
	    <artifactId>maven-antrun-plugin</artifactId>
	    <version>1.2</version>
	    <executions>
	      <execution>
	        <id>run</id>
	        <phase>process-resources</phase>
	        <configuration>
	          <tasks>
	            
                <echo message="$$$$$$$$$$ Installing this archetype $$$$$$$$$$" />
                <java classname="org.codehaus.classworlds.Launcher" dir="." fork="true" failonerror="true">
                  <permissions>
                    <grant class="java.security.AllPermission"/>
                    <grant class="java.io.FilePermission" name="${maven.home}/bin/m2.conf" actions="read" />
                    <grant class="java.util.PropertyPermission" name="*" actions="read,write"/>
                  </permissions>
                  <sysproperty key="classworlds.conf" value="${maven.home}/bin/m2.conf" />
                  <sysproperty key="maven.home" value="${maven.home}" />
                  <classpath>
                    <fileset dir="${maven.home}/boot">
                      <include name="**/*.jar"/>
                    </fileset>
                  </classpath>
                  <arg value="clean" />
                  <arg value="install" />
                </java>
                
                <echo message="$$$$$$$$$$ Generating an example HST application from the archetype $$$$$$$$$$" />
                <java classname="org.codehaus.classworlds.Launcher" dir="target" fork="true" failonerror="true">
                  <permissions>
                    <grant class="java.security.AllPermission"/>
                    <grant class="java.io.FilePermission" name="${maven.home}/bin/m2.conf" actions="read" />
                    <grant class="java.util.PropertyPermission" name="*" actions="read,write"/>
                  </permissions>
                  <sysproperty key="classworlds.conf" value="${maven.home}/bin/m2.conf" />
                  <sysproperty key="maven.home" value="${maven.home}" />
                  <classpath>
                    <fileset dir="${maven.home}/boot">
                      <include name="**/*.jar"/>
                    </fileset>
                  </classpath>
                  <arg value="archetype:generate" />
                  <arg value="-DarchetypeGroupId=org.onehippo.ecm.hst" />
                  <arg value="-DarchetypeArtifactId=hst-archetype" />
                  <arg value="-DarchetypeVersion=${pom.version}" />
                  <arg value="-Dversion=1.01.00" />
                  <arg value="-DgroupId=org.example" />
                  <arg value="-DartifactId=myproject" />
                </java>
                
                <echo message="$$$$$$$$$$ Packaging an example HST application from the archetype $$$$$$$$$$" />
                <java classname="org.codehaus.classworlds.Launcher" dir="target/myproject" fork="true" failonerror="true">
                  <permissions>
                    <grant class="java.security.AllPermission"/>
                    <grant class="java.io.FilePermission" name="${maven.home}/bin/m2.conf" actions="read" />
                    <grant class="java.util.PropertyPermission" name="*" actions="read,write"/>
                  </permissions>
                  <sysproperty key="classworlds.conf" value="${maven.home}/bin/m2.conf" />
                  <sysproperty key="maven.home" value="${maven.home}" />
                  <classpath>
                    <fileset dir="${maven.home}/boot">
                      <include name="**/*.jar"/>
                    </fileset>
                  </classpath>
                  <arg value="install" />
                </java>
                
                <echo message="$$$$$$$$$$ Running an example Hippo Repository $$$$$$$$$$" />
                <java classname="org.codehaus.classworlds.Launcher" dir="target/myproject/cms" fork="true" spawn="true">
                  <permissions>
                    <grant class="java.security.AllPermission"/>
                    <grant class="java.io.FilePermission" name="${maven.home}/bin/m2.conf" actions="read" />
                    <grant class="java.util.PropertyPermission" name="*" actions="read,write"/>
                  </permissions>
                  <sysproperty key="classworlds.conf" value="${maven.home}/bin/m2.conf" />
                  <sysproperty key="maven.home" value="${maven.home}" />
                  <classpath>
                    <fileset dir="${maven.home}/boot">
                      <include name="**/*.jar"/>
                    </fileset>
                  </classpath>
                  <arg value="jetty:run-war" />
                </java>
                
                <echo message="$$$$$$$$$$ Sleeping for a while to give time to the Repository $$$$$$$$$$" />
                <sleep seconds="60"/>
                
	          </tasks>
	        </configuration>
	        <goals>
	          <goal>run</goal>
	        </goals>
	      </execution>
	    </executions>
          </plugin>
        </plugins>
      </build>
    </profile>
  </profiles>

</project>
