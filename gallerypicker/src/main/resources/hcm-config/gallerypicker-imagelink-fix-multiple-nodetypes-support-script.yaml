definitions:
  config:
    /hippo:configuration/hippo:update/hippo:queue/GalleryPickerFixMultipleNodetypesSupport:
      jcr:primaryType: hipposys:updaterinfo
      hipposys:batchsize: 10
      hipposys:description: ''
      hipposys:dryrun: false
      hipposys:parameters: ''
      hipposys:query: //element(*, hipposysedit:field)[@hipposysedit:type='hippogallerypicker:imagelink']
      hipposys:script: "package org.hippoecm.frontend.plugins.cms.admin.updater\r\n\
        \r\nimport org.onehippo.repository.update.BaseNodeUpdateVisitor\r\nimport\
        \ javax.jcr.Node\r\n\r\nclass UpdaterTemplate extends BaseNodeUpdateVisitor\
        \ {\r\n\r\n  boolean doUpdate(Node node) {\r\n    String fieldName = node.getName()\r\
        \n    log.debug \"Checking node ${node.path}\"\r\n    Node typeNode = node.getParent().getParent().getParent()\r\
        \n    if (typeNode.hasNode(\"editor:templates/_default_/${fieldName}/cluster.options\"\
        )) {\r\n      Node fieldConfig = typeNode.getNode(\"editor:templates/_default_/\"\
        +fieldName+\"/cluster.options\")\r\n      if (fieldConfig.hasProperty(\"nodetypes\"\
        ) && !fieldConfig.getProperty(\"nodetypes\").isMultiple()) {\r\n        log.debug\
        \ \"Updating property ${fieldConfig.path}/nodetypes to multivalue\"\r\n  \
        \      String[] values = [fieldConfig.getProperty(\"nodetypes\").getString()]\r\
        \n        fieldConfig.getProperty(\"nodetypes\").remove()\r\n        fieldConfig.setProperty(\"\
        nodetypes\", values)\r\n        return true;\n      }\r\n    }\r\n    return\
        \ false\r\n  }\r\n\r\n  boolean undoUpdate(Node node) {\r\n    throw new UnsupportedOperationException('Updater\
        \ does not implement undoUpdate method')\r\n  }\r\n\r\n}"
      hipposys:throttle: 1000
