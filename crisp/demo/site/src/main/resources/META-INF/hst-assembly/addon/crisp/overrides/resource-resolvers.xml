<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.1.xsd">

  <bean id="defaultResourceResolverMap"
        class="org.springframework.beans.factory.config.MapFactoryBean">
    <property name="sourceMap">
      <map>
        <entry key="productCatalogs">
          <bean parent="abstractSimpleJacksonRestTemplateResourceResolver"
                class="org.onehippo.cms7.crisp.core.resource.jackson.SimpleJacksonRestTemplateResourceResolver">
            <property name="baseUri" value="${crisp.resource.resolver.productCatalogs.baseUri}" />
            <property name="resourceLinkResolver">
              <bean class="org.onehippo.cms7.crisp.core.resource.FreemarkerTemplateResourceLinkResolver">
                <property name="templateSource">
                  <value>http://www.example.com/products/${(preview == "true")?then("staging", "current")}/sku/${resource.valueMap['SKU']!"unknown"}/overview.html</value>
                </property>
              </bean>
            </property>
          </bean>
        </entry>
      </map>
    </property>
  </bean>

</beans>
