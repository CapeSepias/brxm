<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE document PUBLIC
  "-//Apache Software Foundation//DTD XDOC 1.0//EN"
  "http://maven.apache.org/dtd/xdoc_1_0.dtd">
<!--
  Copyright 2007 Hippo
  
  Licensed under the Apache License, Version 2.0 (the  "License"); 
  you may not use this file except in compliance with the License. 
  You may obtain a copy of the License at
  
  http://www.apache.org/licenses/LICENSE-2.0
  
  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" 
  BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. 
  See the License for the specific language governing permissions and 
  limitations under the License.
-->
<document>
    <properties>
        <title>Developing with Eclipse</title>
    </properties>
    <body>
      
        <section name="Building with Eclipse"></section>

        <section name="Prepare">
            <p>
                Follow all steps documented on the <a href="maven.html">Developing with Maven</a> page.
                Don't continue with the instructions on this page before you have seen a running application.
            </p>
        </section>

        <section name="Install plugins">
            <p>Install the Eclipse Subversion Plugin</p>
            <ol>
                <li>Help -&gt; Software Updates -&gt; Find and Install...</li>
                <li>Search for new features to install</li>
                <li>New remote site</li>
                <li>Name='Subversive' URL='http://www.polarion.org/projects/subversive/download/1.1/update-site/'</li>
                <li>Finish the wizard</li>
            </ol>
            <p>Configure the Eclipse Subversion Plugin</p>
            <ol>
                <li>Window -&gt; Preferences -&gt; Team -&gt; SVN</li>
                <li>Select 'SVN Client' tab</li>
                <li>Set 'SVN Client' to 'SVN Kit'</li>
                <li>Apply changes and close the dialog</li>
            </ol>
            <p>Install Jetty</p>
            <ol>
                <li>
                    <a href="http://docs.codehaus.org/display/JETTY/Downloading+and+Installing">
                    Download and install</a> Jetty version >= 6.0
                </li>
            </ol>
            <p>Install Eclipse Jetty Plugin</p>
            <ol>
                <li>Help -&gt; Software Updates -&gt; Find and Install...</li>
                <li>Search for new features to install</li>
                <li>New remote site</li>
                <li>Name='Jetty launcher' URL='http://dbpowder.sourceforge.net/etc/jettylauncher6/updates/'</li>
                <li>Finish the wizard</li>
            </ol>
            <p>Install the Eclipse RMI Plugin</p>
            <ol>
                <li>Help -&gt; Software Updates -&gt; Find and Install...</li>
                <li>Search for new features to install</li>
                <li>New remote site</li>
                <li>Name='RMI plugin' URL='http://www.genady.net/rmi/v20/update/'</li>
                <li>Finish the wizard</li>
            </ol>
            <p>Install the Eclipse JPOX Plugin</p>
            <ol>
                <li>Help -&gt; Software Updates -&gt; Find and Install...</li>
                <li>Search for new features to install</li>
                <li>New remote site</li>
                <li>Name='JPOX launcher' URL='http://www.jpox.org/downloads/eclipse-update/'</li>
                <li>Finish the wizard</li>
                <li>Window -&gt; Preferences</li>
                <li>Select JPOX Eclipse Plugin -&gt; General</li>
                <li>Uncheck 'Use project classpath when running tools'</li>
		        <li>Add the jars for jpox-core, jpox-enhancer and bcel to the classpath.  Currently
                    the version 1.2.0-beta-2 is used for JPOX and 5.1 for BCEL; to maintain
                    consistency with the maven build, check these values in the jpox-maven-plugin
                    pom file.</li>
            </ol>
        </section>

        <section name="Create Eclipse projects">
            <p style="bgcolor: yellow;">
                WARNING: Make sure that there is no .project file in the toplevel (hippo-ecm) directory
                before proceding. If there is one the eclipse import projects wizard will fail.
            </p>
            <p>
                Generate eclipse project files
            </p>
            <source>
~/> cd hippo-ecm
~/hippo-ecm> mvn clean
~/hippo-ecm> mvn eclipse:eclipse
            </source>
            <ol>
                <li>
                    Start eclipse, the workspace directory can be any directory EXCEPT the directory
                    under which you have checked out the source (~/hippo-ecm in the example)
                </li>
                <li>Run the import project wizard: File -&gt; Import -&gt; General -&gt; Existing Projects into Workspace</li>
                <li>Press 'Browse'</li>
                <li>Select the 'hippo-ecm' directory, press OK</li>
                <li>All hippo-ecm projects should be listed</li>
                <li>Press 'Finish'</li>
            </ol>
            <subsection name="Fix dependencies">
                <p>
                    Not all dependencies are correctly set by the maven eclipse plugin,
                    these dependencies have to be set manually.
                </p>
                <ol>
                    <li>Select project hippo-ecm-application-reviewed-action-repository</li>
                    <li>In the configuration panel (Project -&gt; Properties), select 'Java Build Path'</li>
                    <li>Under tab 'Projects', add hippo-ecm-repository-application</li>
                </ol>
                <p>.</p>
                <ol>
                    <li>Select project hippo-ecm-application-reviewed-action-frontend</li>
                    <li>In the configuration panel (Project -&gt; Properties), select 'Java Build Path'</li>
                    <li>Under tab 'Projects', add hippo-ecm-frontend-application</li>
                    <li>Under tab 'Projects', add hippo-ecm-frontend-plugins</li>
                </ol>
            </subsection>
        </section>

        <section name="Configure plugins for projects">
            <subsection name="RMI">
                <p>
                    For projects that provide objects that can be accessed remotely,
                    (hippo-ecm-repository-engine, hippo-ecm-repository-application,
                    hippo-ecm-addon-sample-repository, hippo-ecm-addon-reviewed-action-repository)
                    stubs must be created by rmic.  The plugin can be used to do this:
                </p>
                <ol>
                    <li>right-click project -&gt; RMI -&gt; Enable Stubs generation</li>
                </ol>
            </subsection>
            <subsection name="JPOX">
                <p>
                    Projects that provide document types (hippoecm-repository-engine,
                    hippo-ecm-addon-sample-repository, hippo-ecm-addon-reviewed-action-repository)
                    must be enhanced by the JPOX plugin: open the 'Package explorer' view and:
                </p>
                <ol>
                    <li>Right-click the project -&gt; JPOX -&gt; Add JPOX Support</li>
                    <li>Right-click -&gt; JPOX -&gt; Enable Auto-Enhancement</li>
                </ol>
            </subsection>
        </section>


        <section name="Jetty launcher">
            <p>
                <a href="http://jettylauncher.sourceforge.net/docs/quickstart.html">Create Jetty
                launcher configurations</a> for the projects
                hippo-ecm-application-reviewed-action-repository and
                hippo-ecm-application-reviewed-action-frontend.
                As a convention port 8081 is used for the repository and 8082 for the frontend.
            </p>
            <p>
                Additional configuration is necessary to enable RMI.
            </p>

            <subsection name="Repository application">
                <p>Update the repository application configuration:</p>
                <ol>
                    <li>Open the debug configuration panel (e.g. Run -&gt; Open Debug Dialog...)</li>
                    <li>Set the webapp dir to src/main/webapp</li>
                    <li>Set the port to 8081</li>
                    <li>Select the 'Arguments' tab</li>
                    <li>Define the variable <code>m2_loc</code> (Variables -&gt; Edit -&gt; New)
                        as the path to the local maven repository (e.g. /home/user/.m2/repository on Unix systems)</li>
                    <li>Define the variable <code>ecm_loc</code> as the path of the toplevel directory
                        (e.g. /home/user/hippo-ecm)</li>
                    <li>Add
<source>
-Djava.rmi.server.codebase="file://${m2_loc}/org/apache/jackrabbit/jackrabbit-jcr-rmi/1.4-r593117/jackrabbit-jcr-rmi-1.4-r593117.jar
     file://${m2_loc}/javax/jcr/jcr/1.0/jcr-1.0.jar
     file://${ecm_loc}/addon/reviewed-action/repository/target/classes/"
</source>
                        to the VM Arguments (tab "Arguments")</li>
                </ol>
            </subsection>

            <subsection name="Frontend application">
                <p>Update the frontend application configuration:</p>
                <ol>
                    <li>Open the debug configuration panel (e.g. Run -&gt; Open Debug Dialog...)</li>
                    <li>Set the webapp dir to src/main/webapp</li>
                    <li>Set the port to 8082</li>
                    <li>Add
<source>
-Djava.security.manager
    -Djava.security.policy=file://${ecm_loc}/application/reviewed-action/frontend/src/main/webapp/WEB-INF/client.policy
</source>
                      to the VM Arguments (tab "Arguments")</li>
                </ol>
            </subsection>
        </section>

        <section name="Run">
            <p>
                You can now debug the frontend and repository applications at the same time, within
                Eclipse.
            </p>
        </section>

    </body>
</document>


