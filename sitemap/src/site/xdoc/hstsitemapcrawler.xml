<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE document PUBLIC
        "-//Apache Software Foundation//DTD XDOC 1.0//EN"
        "http://maven.apache.org/dtd/xdoc_1_0.dtd">
<!--
    Copyright 2009-2013 Hippo B.V. (http://www.onehippo.com)

    Licensed under the Apache License, Version 2.0 (the  "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS"
    BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
<document>
    <properties>
        <title>HST Sitemap Crawler</title>
    </properties>
    <body>
        <section name="HST Sitemap Crawler">
            <subsection name="Resolving Sitemap Items">
                <p>
                    This module resolves all the items of the site based on the HST sitemap.
                    Sitemap items can be excluded based on a reference ID (hst:refid), component configuration ID
                    (hst:componentconfigurationid) or based on the content path
                    (e.g. <i>news/_default_/subject/_any_.html</i>). These exclusions can be specified in the HST configuration. The
                    sitemap acts according the
<a href="http://support.google.com/webmasters/bin/answer.py?hl=en&amp;cbrank=1&amp;cbid=1ox23pat60mkn&amp;ctx=cb&amp;answer=183668&amp;src=cb">
                    specifications</a> provided by Google, which means that Google accepts and
                    recognizes the sitemap. This will lead to better (i.e. higher percentage) findability of the site pages
                    in Google.
                </p>
                <p>
                    All the items in the sitemap are canonicals, i.e. the location of each item is printed with the
                    shortest path to this item location. For instance, when defined in the sitemap <i>news/_any_.html</i>
                    and <i>archive/news/_any_.html</i> and a document 'hello-world' can be reached via <i>news/hello-world.html</i>
                    and <i>archive/news/hello-world.html</i> (so 2 locations linking to the same document), then the
                    location <i>news/hello-world.html</i> is referred to 'hello-world' in the sitemap, because this is
                    the shortest path and so leaving out the redundant locations saving time and storage. See also
                    <a href="sitemapindex.html">Sitemap Index</a>.
                </p>
                <p>
                    The sitemap determines based on its mount type which documents it will return. The sitemap excludes
                    unpublished documents when being called from the live site and will include them when being called
                    from the preview site.
                </p>
                <p>
                    The HST Sitemap Crawler is multi-threaded. It can use multiple Threads to generate the sitemap. The
                    number of Threads (so called workers) can be manually set in the HST configuration to assign a value
                    to the <i>amountOfWorkers</i> parameter. Its default value, so the default number of Threads, is 4.
                </p>
            </subsection>
            <subsection name="Configuration">
                <p>
                    In the console under <i>hst:hst/hst:configurations/hst:default/hst:components</i> exists a component
                    called <i>forge-sitemap-based-on-hst-configuration-feed</i>. This component renders the sitemap based
                    on parameters, which are used in the component's class <i>SitemapFeedBasedOnHstSitemap</i>. These
                    parameters can be set in the sitemapitem <i>sitemap.xml</i>, which can be found under
                    <i>hst:hst/hst:configurations/[YOURDOMAIN]/hst:sitemap</i>.
                    Here can the configurations and/or parameters be set. Non of the parameters are required, they are
                    all optional, i.e. when these parameters are not filled, then they will be considered as not existing.
                </p>
                <h4>Parameters</h4>
                <p>
                    <table>
                        <tr>
                            <th>Parameter</th>
                            <th>Description</th>
                        </tr>
                        <tr>
                            <td>sitemapRefIdExclusions</td>
                            <td>The reference ID's (hst:refid) to exclude</td>
                        </tr>
                        <tr>
                            <td>splitter-enabled</td>
                            <td>true: if sitemap needs to be split in multiple sitemaps<br/>
                                false: otherwise</td>
                        </tr>
                        <tr>
                            <td>splitter-destination-foldername</td>
                            <td>Folder name of the sitemap index file</td>
                        </tr>
                        <tr>
                            <td>informationProvider</td>
                            <td>Location of the site specific class (which extends the DefaultUrlInformationProvider
                                class from the forge sitemap project)</td>
                        </tr>
                        <tr>
                            <td>sitemapComponentConfigurationIdExclusions</td>
                            <td>The component configuration ID's (hst:componentconfigurationid) to exclude</td>
                        </tr>
                        <tr>
                            <td>sitemapPathExclusions</td>
                            <td>The sitemap paths to exclude</td>
                        </tr>
                        <tr>
                            <td>write-to-repository</td>
                            <td>true: if the sitemap index file may write to the repository<br/>
                                false: otherwise</td>
                        </tr>
                        <tr>
                            <td>amountOfWorkers</td>
                            <td>The number of Threads used to generate the sitemap</td>
                        </tr>
                    </table>
                </p>
                <p>
                    Site specific configuration can be done in a new Java class in your own project (e.g. UrlSitemapRenderer).
                    This class must extend <i>DefaultUrlInformationProvider</i> class from the forge sitemap project.
                    Simply by overriding the methods from the <i>DefaultUrlInformationProvider</i> and change the body
                    of the method you can adjust it to your own preferences. See the example below.
                </p>
                <p>
                    <source><![CDATA[public class UrlSitemapRenderer extends DefaultUrlInformationProvider {
  @Override
  public String getLoc(final HippoBean hippoBean,
                       final HstRequestContext requestContext) {
    return "Something else";
  }

  @Override
  public BigDecimal getPriority(final HippoBean hippoBean) {
    return 1.0;
  }}]]></source>
                </p>
                <p>
                    An example of how the HST configuration could look like if you, for example, would like to:
                    <ul>
                        <li>
                            exclude documents which contain the refId's <i>admin</i> or <i>private</i></li>
                        <li>
                            use the sitmap splitter to split the sitemap into multiple sitemaps
                        </li>
                        <li>
                            set the destination folder for the splitter to <i>sitemap-splitter-directory</i>
                        </li>
                        <li>
                            set the class of the site specific configuration (as described above) to <i>UrlSitemapRenderer</i>
                            which is in the package <i>one.hippo.site.sitemap</i>
                        </li>
                        <li>
                            exclude documents which contain the component configuration Id <i>hst:pages/404</i>
                        </li>
                        <li>
                            exclude documents which match to <br/>
                            <i>subject/_default_/_default_/news/_any_.html</i> <br/>
                            <i>subject/_default_/_default_/faq/_any_.html</i> <br/>
                            <i>info/_default_/_default_/news/_any_.html</i> <br/>
                            <i>info/_default_/_default_/faq/_any_.html</i> <br/>
                            <i>sitemap.xml</i> <br/>
                            <i>draft</i>
                        </li>
                        <li>
                            write to the repository
                        </li>
                        <li>
                            set the amount of workers (Threads) to 4
                        </li>
                    </ul>
                    Click for an illustration on the following link:
                    <a href="./sitemapxml.jpg" rel="external">Example HST configuration</a><br/>

                </p>
            </subsection>
            <subsection name="Admire the result">
                <p>
                    Start your CMS and site.
                </p>
                <p>
                    <ul><li>Open your site in your browser, and check out your <i>LIVE</i> sitemap! <br/>
                    (http://[YOURDOMAIN]/site/sitemap.xml)</li></ul>
                </p>
                <p>
                    or
                </p>
                <p>
                    <ul><li>Open your site in your browser, and check out your <i>PREVIEW</i> sitemap! <br/>
                    (http://[YOURDOMAIN]/site/preview/sitemap.xml)</li></ul>
                </p>
                <p>
                    Your browser may not display the sitemap as XML. View the page source to see
                    the sitemap XML.
                </p>
            </subsection>
       </section>
    </body>
</document>
